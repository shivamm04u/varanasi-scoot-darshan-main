<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
import { 
  getAuth,
  signInWithEmailAndPassword,
  createUserWithEmailAndPassword,
  signInWithPopup,
  signInWithRedirect,
  getRedirectResult,
  GoogleAuthProvider,
  sendPasswordResetEmail,
  updateProfile,
  fetchSignInMethodsForEmail
} from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
import { 
  getFirestore,
  doc,
  getDoc,
  setDoc,
  serverTimestamp
} from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

// â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
// â•‘  ğŸ” ROLE CONFIGURATION - EDIT YOUR EMAILS HERE                â•‘
// â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const ROLE_CONFIG = {
  super_admin: [
    'shivampandit2006@gmail.com',
    // Add more super admin emails
  ],
  
  admin: [
    'aruneshsinghrajawat@gmail.com',
    // Add your admin emails here
  ],
  
  manager: [
    'anshumanjha3333@gmail.com',
    // Add your manager emails here
  ],
  
  guide: [
    'guide@bababanarasi.com',
  ]
};

// Redirect URLs
const REDIRECT_URLS = {
  super_admin: '/dashboard/admin.html',
  admin: '/dashboard/admin.html',
  manager: '/dashboard/manager.html',
  guide: '/dashboard/guide.html',
  user: '/index.html'
};

// â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
// â•‘  ğŸ”¥ FIREBASE CONFIG                                           â•‘
// â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const firebaseConfig = {
  apiKey: "AIzaSyCtyR68dG9TEI_C89PvsdrGmpkE6vCtV0s",
  authDomain: "varanasi-scoot-darshan.firebaseapp.com",
  projectId: "varanasi-scoot-darshan",
  storageBucket: "varanasi-scoot-darshan.firebasestorage.app",
  messagingSenderId: "437910870938",
  appId: "1:437910870938:web:cb7b3043bcc39216143823"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const googleProvider = new GoogleAuthProvider();
googleProvider.addScope('email');
googleProvider.addScope('profile');
googleProvider.setCustomParameters({ prompt: 'select_account' });

// â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
// â•‘  ğŸ¯ ROLE HELPER FUNCTIONS                                     â•‘
// â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function getRoleByEmail(email) {
  if (!email) return 'user';
  
  const lowerEmail = email.toLowerCase().trim();
  
  for (const [role, emails] of Object.entries(ROLE_CONFIG)) {
    const lowerEmails = emails.map(e => e.toLowerCase().trim());
    if (lowerEmails.includes(lowerEmail)) {
      console.log(`âœ… ROLE MATCH: ${email} â†’ ${role.toUpperCase()}`);
      return role;
    }
  }
  
  console.log(`ğŸ‘¤ DEFAULT ROLE: ${email} â†’ user`);
  return 'user';
}

function getRedirectUrl(role) {
  return REDIRECT_URLS[role] || '/index.html';
}

// â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
// â•‘  ğŸš€ FAST REDIRECT FUNCTION (No Firestore Dependency)          â•‘
// â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function redirectNow(email, displayName) {
  const role = getRoleByEmail(email);
  const url = getRedirectUrl(role);
  
  console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
  console.log(`ğŸš€ REDIRECTING NOW`);
  console.log(`   Email: ${email}`);
  console.log(`   Role: ${role}`);
  console.log(`   URL: ${url}`);
  console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
  
  // Show success message
  showAlert('success', `Welcome, ${displayName || 'Bagpackerr'}! Redirecting to ${role} panel...`);
  
  // Redirect after short delay
  setTimeout(() => {
    window.location.href = url;
  }, 1000);
}

// â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
// â•‘  ğŸ’¾ SAVE USER TO FIRESTORE (Non-blocking)                     â•‘
// â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

async function saveUserToFirestore(user, additionalData = {}) {
  // Don't wait for this - do it in background
  try {
    const role = getRoleByEmail(user.email);
    const userRef = doc(db, 'users', user.uid);
    
    const userData = {
      uid: user.uid,
      email: user.email,
      displayName: user.displayName || additionalData.displayName || 'Bagpackerr',
      phone: user.phoneNumber || additionalData.phone || null,
      photoURL: user.photoURL || null,
      role: role,
      provider: additionalData.provider || 'email',
      lastLogin: new Date().toISOString(),
      updatedAt: new Date().toISOString()
    };
    
    // Check if user exists
    const userDoc = await getDoc(userRef);
    
    if (!userDoc.exists()) {
      userData.createdAt = new Date().toISOString();
      userData.bookings = [];
      userData.reviews = [];
    }
    
    await setDoc(userRef, userData, { merge: true });
    console.log('âœ… User saved to Firestore');
    
  } catch (error) {
    console.error('âš ï¸ Firestore save failed (non-critical):', error.message);
    // Don't throw - this is non-critical
  }
}

// â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
// â•‘  ğŸ“¦ STATE & DOM                                               â•‘
// â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let isLoginMode = true;
let isLoading = false;

const elements = {
  form: document.getElementById('authForm'),
  email: document.getElementById('email'),
  password: document.getElementById('password'),
  name: document.getElementById('name'),
  phone: document.getElementById('phone'),
  countryCode: document.getElementById('countryCode'),
  submitBtn: document.getElementById('submitBtn'),
  btnContent: document.getElementById('btnContent'),
  googleBtn: document.getElementById('googleBtn'),
  toggleLink: document.getElementById('toggleLink'),
  toggleText: document.getElementById('toggleText'),
  formTitle: document.getElementById('formTitle'),
  formSubtitle: document.getElementById('formSubtitle'),
  alertError: document.getElementById('alertError'),
  alertSuccess: document.getElementById('alertSuccess'),
  alertInfo: document.getElementById('alertInfo'),
  errorText: document.getElementById('errorText'),
  successText: document.getElementById('successText'),
  infoText: document.getElementById('infoText'),
  togglePassword: document.getElementById('togglePassword'),
  eyeIcon: document.getElementById('eyeIcon'),
  eyeOffIcon: document.getElementById('eyeOffIcon'),
  nameField: document.getElementById('nameField'),
  phoneField: document.getElementById('phoneField'),
  formOptions: document.getElementById('formOptions'),
  termsCheckbox: document.getElementById('termsCheckbox'),
  termsAgree: document.getElementById('termsAgree'),
  passwordStrength: document.getElementById('passwordStrength'),
  strengthFill: document.getElementById('strengthFill'),
  strengthText: document.getElementById('strengthText'),
  emailWrapper: document.getElementById('emailWrapper'),
  emailError: document.getElementById('emailError'),
  forgotPassword: document.getElementById('forgotPassword'),
  rememberMe: document.getElementById('rememberMe')
};

// â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
// â•‘  ğŸ¨ UI FUNCTIONS                                              â•‘
// â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function showAlert(type, message) {
  hideAlerts();
  
  const alertEl = type === 'error' ? elements.alertError : 
                  type === 'success' ? elements.alertSuccess : 
                  elements.alertInfo;
  const textEl = type === 'error' ? elements.errorText : 
                 type === 'success' ? elements.successText : 
                 elements.infoText;
  
  if (alertEl && textEl) {
    textEl.textContent = message;
    alertEl.classList.add('visible');
  }
}

function hideAlerts() {
  elements.alertError?.classList.remove('visible');
  elements.alertSuccess?.classList.remove('visible');
  elements.alertInfo?.classList.remove('visible');
}

function setLoading(loading) {
  isLoading = loading;
  
  if (elements.submitBtn) elements.submitBtn.disabled = loading;
  if (elements.googleBtn) elements.googleBtn.disabled = loading;
  
  if (elements.btnContent) {
    if (loading) {
      elements.btnContent.innerHTML = `
        <div class="btn-spinner"></div>
        <span>${isLoginMode ? 'Signing in...' : 'Creating account...'}</span>
      `;
    } else {
      elements.btnContent.innerHTML = `<span>${isLoginMode ? 'Sign In' : 'Create Account'}</span>`;
    }
  }
  
  if (elements.googleBtn) {
    elements.googleBtn.style.opacity = loading ? '0.6' : '1';
  }
}

function toggleMode() {
  isLoginMode = !isLoginMode;
  hideAlerts();
  if (elements.form) elements.form.reset();
  
  if (isLoginMode) {
    if (elements.formTitle) elements.formTitle.textContent = 'Welcome Back';
    if (elements.formSubtitle) elements.formSubtitle.textContent = 'Sign in to manage your darshan bookings';
    if (elements.btnContent) elements.btnContent.innerHTML = '<span>Sign In</span>';
    if (elements.toggleText) elements.toggleText.textContent = "Don't have an account?";
    if (elements.toggleLink) elements.toggleLink.textContent = 'Create one';
    elements.nameField?.classList.remove('visible');
    elements.phoneField?.classList.remove('visible');
    if (elements.formOptions) elements.formOptions.style.display = 'flex';
    elements.termsCheckbox?.classList.remove('visible');
    elements.passwordStrength?.classList.remove('visible');
  } else {
    if (elements.formTitle) elements.formTitle.textContent = 'Create Account';
    if (elements.formSubtitle) elements.formSubtitle.textContent = 'Join thousands of happy Bagpackerrs';
    if (elements.btnContent) elements.btnContent.innerHTML = '<span>Create Account</span>';
    if (elements.toggleText) elements.toggleText.textContent = 'Already have an account?';
    if (elements.toggleLink) elements.toggleLink.textContent = 'Sign in';
    elements.nameField?.classList.add('visible');
    elements.phoneField?.classList.add('visible');
    if (elements.formOptions) elements.formOptions.style.display = 'none';
    elements.termsCheckbox?.classList.add('visible');
    elements.passwordStrength?.classList.add('visible');
  }
}

function togglePasswordVisibility() {
  if (!elements.password) return;
  const type = elements.password.type === 'password' ? 'text' : 'password';
  elements.password.type = type;
  if (elements.eyeIcon) elements.eyeIcon.style.display = type === 'text' ? 'none' : 'block';
  if (elements.eyeOffIcon) elements.eyeOffIcon.style.display = type === 'text' ? 'block' : 'none';
}

function checkPasswordStrength(password) {
  if (!elements.strengthFill || !elements.strengthText) return;
  
  let strength = 0;
  if (password.length >= 6) strength++;
  if (password.length >= 10) strength++;
  if (/[A-Z]/.test(password)) strength++;
  if (/[0-9]/.test(password)) strength++;
  if (/[^A-Za-z0-9]/.test(password)) strength++;
  
  elements.strengthFill.className = 'strength-fill';
  elements.strengthText.className = 'strength-text';
  
  if (password.length === 0) {
    elements.strengthText.textContent = 'Password strength';
  } else if (strength <= 2) {
    elements.strengthFill.classList.add('weak');
    elements.strengthText.classList.add('weak');
    elements.strengthText.textContent = 'Weak password';
  } else if (strength <= 3) {
    elements.strengthFill.classList.add('medium');
    elements.strengthText.classList.add('medium');
    elements.strengthText.textContent = 'Medium strength';
  } else {
    elements.strengthFill.classList.add('strong');
    elements.strengthText.classList.add('strong');
    elements.strengthText.textContent = 'Strong password';
  }
}

function validateEmail(email) {
  return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
}

function showFieldError(wrapper, errorElement, show) {
  if (wrapper) wrapper.classList.toggle('error', show);
  if (errorElement) errorElement.style.display = show ? 'flex' : 'none';
}

function getErrorMessage(errorCode) {
  const messages = {
    'auth/invalid-email': 'Please enter a valid email address',
    'auth/user-disabled': 'This account has been disabled',
    'auth/user-not-found': 'No account found with this email',
    'auth/wrong-password': 'Incorrect password',
    'auth/invalid-credential': 'Invalid email or password',
    'auth/email-already-in-use': 'Email already registered',
    'auth/weak-password': 'Password should be at least 6 characters',
    'auth/network-request-failed': 'Network error. Check your connection.',
    'auth/too-many-requests': 'Too many attempts. Try again later.',
    'auth/popup-blocked': 'Popup blocked. Please allow popups.',
    'auth/popup-closed-by-user': 'Sign-in was cancelled',
    'auth/operation-not-allowed': 'Sign-in method not enabled',
    'auth/unauthorized-domain': 'Domain not authorized'
  };
  return messages[errorCode] || `Error: ${errorCode}`;
}

// â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
// â•‘  ğŸ“§ EMAIL/PASSWORD LOGIN (OPTIMIZED)                          â•‘
// â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

async function handleSubmit(e) {
  e.preventDefault();
  if (isLoading) return;
  
  const email = elements.email?.value.trim();
  const password = elements.password?.value;
  const name = elements.name?.value.trim();
  const phone = elements.phone?.value.trim();
  const countryCode = elements.countryCode?.value || '+91';
  
  console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
  console.log(`ğŸ“§ ${isLoginMode ? 'LOGIN' : 'SIGNUP'} ATTEMPT`);
  console.log(`   Email: ${email}`);
  console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
  
  // Validation
  if (!validateEmail(email)) {
    showFieldError(elements.emailWrapper, elements.emailError, true);
    showAlert('error', 'Please enter a valid email address');
    return;
  }
  
  if (!password || password.length < 6) {
    showAlert('error', 'Password must be at least 6 characters');
    return;
  }
  
  if (!isLoginMode) {
    if (!name) {
      showAlert('error', 'Please enter your full name');
      return;
    }
    if (elements.termsAgree && !elements.termsAgree.checked) {
      showAlert('error', 'Please agree to the Terms of Service');
      return;
    }
  }
  
  hideAlerts();
  setLoading(true);
  
  try {
    let user;
    let displayName;
    
    if (isLoginMode) {
      // â•â•â•â•â•â•â•â•â•â•â• LOGIN â•â•â•â•â•â•â•â•â•â•â•
      console.log('ğŸ” Authenticating...');
      const userCredential = await signInWithEmailAndPassword(auth, email, password);
      user = userCredential.user;
      displayName = user.displayName || email.split('@')[0];
      console.log('âœ… Authentication successful!');
      
      // Remember me
      if (elements.rememberMe?.checked) {
        localStorage.setItem('rememberedEmail', email);
      } else {
        localStorage.removeItem('rememberedEmail');
      }
      
    } else {
      // â•â•â•â•â•â•â•â•â•â•â• SIGNUP â•â•â•â•â•â•â•â•â•â•â•
      console.log('ğŸ“ Creating account...');
      const userCredential = await createUserWithEmailAndPassword(auth, email, password);
      user = userCredential.user;
      displayName = name;
      
      // Update display name
      await updateProfile(user, { displayName: name });
      console.log('âœ… Account created!');
    }
    
    // IMMEDIATE REDIRECT (Don't wait for Firestore)
    redirectNow(email, displayName);
    
    // Save to Firestore in background (non-blocking)
    saveUserToFirestore(user, {
      displayName: displayName,
      phone: phone ? `${countryCode}${phone}` : null,
      provider: 'email'
    });
    
  } catch (error) {
    console.error('âŒ Auth Error:', error.code, error.message);
    showAlert('error', getErrorMessage(error.code));
    setLoading(false);
  }
}

// â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
// â•‘  ğŸ”µ GOOGLE SIGN IN (OPTIMIZED)                                â•‘
// â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

async function handleGoogleSignIn() {
  if (isLoading) return;
  
  console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
  console.log('ğŸ”µ GOOGLE SIGN-IN ATTEMPT');
  console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
  
  hideAlerts();
  setLoading(true);
  
  try {
    const result = await signInWithPopup(auth, googleProvider);
    const user = result.user;
    
    console.log('âœ… Google Sign-In successful!');
    console.log(`   Email: ${user.email}`);
    console.log(`   Name: ${user.displayName}`);
    
    // IMMEDIATE REDIRECT
    redirectNow(user.email, user.displayName);
    
    // Save to Firestore in background
    saveUserToFirestore(user, { provider: 'google' });
    
  } catch (error) {
    console.error('âŒ Google Sign-In Error:', error.code);
    
    if (error.code === 'auth/popup-closed-by-user') {
      showAlert('error', 'Sign-in was cancelled');
    } else if (error.code === 'auth/popup-blocked') {
      showAlert('info', 'Popup blocked. Trying redirect...');
      try {
        await signInWithRedirect(auth, googleProvider);
        return;
      } catch (e) {
        showAlert('error', 'Please enable popups and try again');
      }
    } else if (error.code === 'auth/unauthorized-domain') {
      showAlert('error', 'Domain not authorized. Add to Firebase Console.');
    } else {
      showAlert('error', getErrorMessage(error.code));
    }
    setLoading(false);
  }
}

// Check redirect result
async function checkRedirectResult() {
  try {
    const result = await getRedirectResult(auth);
    if (result?.user) {
      console.log('âœ… Redirect sign-in successful');
      redirectNow(result.user.email, result.user.displayName);
      saveUserToFirestore(result.user, { provider: 'google' });
    }
  } catch (error) {
    console.log('No redirect result');
  }
}

// â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
// â•‘  ğŸ”‘ FORGOT PASSWORD                                           â•‘
// â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

async function handleForgotPassword(e) {
  e.preventDefault();
  
  const email = elements.email?.value.trim();
  
  if (!email) {
    showAlert('error', 'Enter your email address first');
    elements.email?.focus();
    return;
  }
  
  if (!validateEmail(email)) {
    showAlert('error', 'Enter a valid email address');
    return;
  }
  
  console.log('ğŸ“§ Password reset for:', email);
  
  try {
    await sendPasswordResetEmail(auth, email);
    showAlert('success', `Reset email sent to ${email}. Check spam folder too!`);
  } catch (error) {
    console.error('Reset error:', error.code);
    if (error.code === 'auth/user-not-found') {
      showAlert('error', 'No account found with this email');
    } else {
      showAlert('error', getErrorMessage(error.code));
    }
  }
}

// â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
// â•‘  ğŸ§ EVENT LISTENERS                                           â•‘
// â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

elements.form?.addEventListener('submit', handleSubmit);
elements.googleBtn?.addEventListener('click', handleGoogleSignIn);
elements.toggleLink?.addEventListener('click', (e) => { e.preventDefault(); toggleMode(); });
elements.togglePassword?.addEventListener('click', togglePasswordVisibility);
elements.password?.addEventListener('input', () => { if (!isLoginMode) checkPasswordStrength(elements.password.value); });
elements.email?.addEventListener('blur', () => {
  const email = elements.email.value.trim();
  showFieldError(elements.emailWrapper, elements.emailError, email && !validateEmail(email));
});
elements.email?.addEventListener('focus', () => showFieldError(elements.emailWrapper, elements.emailError, false));
elements.forgotPassword?.addEventListener('click', handleForgotPassword);

// Load remembered email
const rememberedEmail = localStorage.getItem('rememberedEmail');
if (rememberedEmail && elements.email) {
  elements.email.value = rememberedEmail;
  if (elements.rememberMe) elements.rememberMe.checked = true;
}

// Check redirect result
checkRedirectResult();

// â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
// â•‘  ğŸš€ INITIALIZATION LOG                                        â•‘
// â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

console.log('');
console.log('â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—');
console.log('â•‘  ğŸ›• BABA BANARASI LOGIN - INITIALIZED                 â•‘');
console.log('â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£');
console.log('â•‘  ROLE CONFIGURATION:                                  â•‘');
console.log('â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£');

Object.entries(ROLE_CONFIG).forEach(([role, emails]) => {
  console.log(`â•‘  ${role.toUpperCase()}:`);
  emails.forEach(email => console.log(`â•‘    â†’ ${email}`));
});

console.log('â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£');
console.log('â•‘  REDIRECTS:                                           â•‘');
Object.entries(REDIRECT_URLS).forEach(([role, url]) => {
  console.log(`â•‘    ${role} â†’ ${url}`);
});
console.log('â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
console.log('');
</script>
